<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../hado/shadow.png">
    <link href="../hado/simple.css" rel="stylesheet">
    <title>Shadow</title>
</head>

<body>
    <main>
        <h1 id="test">Making Requests...</h1>
    </main>
</body>
<script>
    window.onload = function(){
        const query = location.hash
        const status = document.getElementById("test")
        if(query && query !== "#"){
            let val = query.slice(1);
            const httprequest = new XMLHttpRequest();
            httprequest.open("GET", "https://api.minehut.com/servers", false);
            httprequest.send(null);
            let slist = httprequest.responseText;
            let found = false;
            let sjson = JSON.parse(slist);
            let serverlist = sjson.servers;
            const httprequest2 = new XMLHttpRequest();
            httprequest2.open("GET", "https://api.ashcon.app/mojang/v2/user/" + val, false);
            httprequest2.send(null);
            let uuid = JSON.parse(httprequest2.responseText).uuid;
            uuid = uuid.replace("-", "");
            console.warn(uuid);
            for(var server of serverlist){
                let players = server["playerData"]["players"];
                for(var player of players){
                    let strippedplayer = player.replace("-", "");
                    if(strippedplayer == uuid){
                        document.getElementById("test").innerHTML = "Player: " + val + "<br>Is Online: " + server["name"] + "";
                        found = true;
                    }
                }
            }
            if(!found){
                status.innerText = "Player: " + val + "<br>Is Online: NONE";
            }   
        }else{
            status.innerText = "Required 'data' parameter missing (Player's Name)"
        }
    };
</script>
